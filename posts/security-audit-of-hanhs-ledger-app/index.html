<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Liste - https://zecsec.com/"><title>Results of Auditing Hanh's Shielded Zcash Ledger App | ZecSec: Zcash Ecosystem Security</title><meta name=description content="Zcash Ecosystem Security Support"><meta property="og:title" content="Results of Auditing Hanh's Shielded Zcash Ledger App"><meta property="og:description" content="In May and June of this year, I reviewed Hanh Huynh Huu&rsquo;s Ledger app supporting shielded Zcash. The full audit report is available at the link below.
Summary of Results The main issues uncovered by the audit were the following:
Side-Channel Leakage The algorithm for producing transaction signatures is not constant-time, therefore it may be possible to leak the user&rsquo;s signing keys through a side-channel attack. This will be fixed by making the code constant-time."><meta property="og:type" content="article"><meta property="og:url" content="https://zecsec.com/posts/security-audit-of-hanhs-ledger-app/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-21T01:01:00-07:00"><meta property="article:modified_time" content="2023-09-21T01:01:00-07:00"><meta itemprop=name content="Results of Auditing Hanh's Shielded Zcash Ledger App"><meta itemprop=description content="In May and June of this year, I reviewed Hanh Huynh Huu&rsquo;s Ledger app supporting shielded Zcash. The full audit report is available at the link below.
Summary of Results The main issues uncovered by the audit were the following:
Side-Channel Leakage The algorithm for producing transaction signatures is not constant-time, therefore it may be possible to leak the user&rsquo;s signing keys through a side-channel attack. This will be fixed by making the code constant-time."><meta itemprop=datePublished content="2023-09-21T01:01:00-07:00"><meta itemprop=dateModified content="2023-09-21T01:01:00-07:00"><meta itemprop=wordCount content="582"><meta itemprop=keywords content><link rel=canonical href=https://zecsec.com/posts/security-audit-of-hanhs-ledger-app/><link rel="shortcut icon" type=image/png href=/favicon-32.png><link rel="shortcut icon" sizes=32x32 href=/favicon-32.png><link rel=dns-prefetch href=https://www.google-analytics.com><link href=https://www.google-analytics.com rel=preconnect crossorigin><link rel=alternate type=application/atom+xml title="ZecSec: Zcash Ecosystem Security" href=https://zecsec.com//atom.xml><link rel=alternate type=application/json title="ZecSec: Zcash Ecosystem Security" href=https://zecsec.com//feed.json><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;background:#f5f5f5;color:#000}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}h1,h2,h3,h4,h5,strong,b{font-size:inherit;font-weight:600}h2{font-size:1.5em}h3{font-size:1.2em;color:#454545}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{margin:.1rem;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}h2.post{margin-bottom:0}.post-date{margin:0% 0;color:#9a9a9a}.index-date{color:#9a9a9a}.animate-blink{animation:opacity 50s infinite;opacity:1;display:none}@keyframes opacity{0%{opacity:1}50%{opacity:.5}100%{opacity:0}}.tags{display:flex;justify-content:space-between}.tags ul{padding:0;margin:0}.tags li{display:inline}.avatar{height:120px;width:120px;position:relative;margin:-10px 0 0 15px;float:right;border-radius:50%}.table{width:100%;margin-bottom:1rem;color:#111}.table-bordered{border:1px solid #dee2e6}table{border-collapse:collapse}.table-bordered thead th,.table-bordered thead td{border-bottom-width:2px}.table thead th{vertical-align:bottom;border-bottom:2px solid #dee2e6;border-bottom-width:2px}.table-bordered th,.table-bordered td{border:1px solid #dee2e6;border-bottom-color:#dee2e6;border-bottom-style:solid;border-bottom-width:1px}.table th,.table td{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}th{text-align:inherit}.table-bordered th,.table-bordered td{border:1px solid #dee2e6}.table th,.table td{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}.table{width:100%;margin-bottom:1rem;color:#111}.table th,.table td{padding:.75rem;vertical-align:top;border-top:1px solid #dee2e6}.table thead th{vertical-align:bottom;border-bottom:2px solid #dee2e6}.table tbody+tbody{border-top:2px solid #dee2e6}.table-sm th,.table-sm td{padding:.3rem}.table-bordered{border:1px solid #dee2e6}.table-bordered th,.table-bordered td{border:1px solid #dee2e6}.table-bordered thead th,.table-bordered thead td{border-bottom-width:2px}.table-borderless th,.table-borderless td,.table-borderless thead th,.table-borderless tbody+tbody{border:0}.table-striped tbody tr:nth-of-type(odd){background-color:rgba(0,0,0,5%)}.table-hover tbody tr:hover{color:#111;background-color:rgba(0,0,0,.075)}.table-primary,.table-primary>th,.table-primary>td{background-color:#b8daff}.table-primary th,.table-primary td,.table-primary thead th,.table-primary tbody+tbody{border-color:#7abaff}.table-hover .table-primary:hover{background-color:#9fcdff}.table-hover .table-primary:hover>td,.table-hover .table-primary:hover>th{background-color:#9fcdff}.table-secondary,.table-secondary>th,.table-secondary>td{background-color:#d6d8db}.table-secondary th,.table-secondary td,.table-secondary thead th,.table-secondary tbody+tbody{border-color:#b3b7bb}.table-hover .table-secondary:hover{background-color:#c8cbcf}.table-hover .table-secondary:hover>td,.table-hover .table-secondary:hover>th{background-color:#c8cbcf}.table-success,.table-success>th,.table-success>td{background-color:#c3e6cb}.table-success th,.table-success td,.table-success thead th,.table-success tbody+tbody{border-color:#8fd19e}.table-hover .table-success:hover{background-color:#b1dfbb}.table-hover .table-success:hover>td,.table-hover .table-success:hover>th{background-color:#b1dfbb}.table-info,.table-info>th,.table-info>td{background-color:#bee5eb}.table-info th,.table-info td,.table-info thead th,.table-info tbody+tbody{border-color:#86cfda}.table-hover .table-info:hover{background-color:#abdde5}.table-hover .table-info:hover>td,.table-hover .table-info:hover>th{background-color:#abdde5}.table-warning,.table-warning>th,.table-warning>td{background-color:#ffeeba}.table-warning th,.table-warning td,.table-warning thead th,.table-warning tbody+tbody{border-color:#ffdf7e}.table-hover .table-warning:hover{background-color:#ffe8a1}.table-hover .table-warning:hover>td,.table-hover .table-warning:hover>th{background-color:#ffe8a1}.table-danger,.table-danger>th,.table-danger>td{background-color:#f5c6cb}.table-danger th,.table-danger td,.table-danger thead th,.table-danger tbody+tbody{border-color:#ed969e}.table-hover .table-danger:hover{background-color:#f1b0b7}.table-hover .table-danger:hover>td,.table-hover .table-danger:hover>th{background-color:#f1b0b7}.table-light,.table-light>th,.table-light>td{background-color:#fdfdfe}.table-light th,.table-light td,.table-light thead th,.table-light tbody+tbody{border-color:#fbfcfc}.table-hover .table-light:hover{background-color:#ececf6}.table-hover .table-light:hover>td,.table-hover .table-light:hover>th{background-color:#ececf6}.table-dark,.table-dark>th,.table-dark>td{background-color:#c6c8ca}.table-dark th,.table-dark td,.table-dark thead th,.table-dark tbody+tbody{border-color:#95999c}.table-hover .table-dark:hover{background-color:#b9bbbe}.table-hover .table-dark:hover>td,.table-hover .table-dark:hover>th{background-color:#b9bbbe}.table-active,.table-active>th,.table-active>td{background-color:rgba(0,0,0,.075)}.table-hover .table-active:hover{background-color:rgba(0,0,0,.075)}.table-hover .table-active:hover>td,.table-hover .table-active:hover>th{background-color:rgba(0,0,0,.075)}.table .thead-dark th{color:#fff;background-color:#343a40;border-color:#454d55}.table .thead-light th{color:#495057;background-color:#e9ecef;border-color:#dee2e6}.table-dark{color:#fff;background-color:#343a40}.table-dark th,.table-dark td,.table-dark thead th{border-color:#454d55}.table-dark.table-bordered{border:0}.table-dark.table-striped tbody tr:nth-of-type(odd){background-color:rgba(255,255,255,5%)}.table-dark.table-hover tbody tr:hover{color:#fff;background-color:rgba(255,255,255,.075)}@media(max-width:575.98px){.table-responsive-sm{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-sm>.table-bordered{border:0}}@media(max-width:767.98px){.table-responsive-md{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-md>.table-bordered{border:0}}@media(max-width:991.98px){.table-responsive-lg{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-lg>.table-bordered{border:0}}@media(max-width:1199.98px){.table-responsive-xl{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive-xl>.table-bordered{border:0}}.table-responsive{display:block;width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.table-responsive>.table-bordered{border:0}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Results of Auditing Hanh\u0027s Shielded Zcash Ledger App","headline":"Results of Auditing Hanh\u0027s Shielded Zcash Ledger App","alternativeHeadline":"","description":"In May and June of this year, I reviewed Hanh Huynh Huu\u0026rsquo;s Ledger app supporting shielded Zcash. The full audit report is available at the link below.\nSummary of Results The main issues uncovered by the audit were the following:\nSide-Channel Leakage The algorithm for producing transaction signatures is not constant-time, therefore it may be possible to leak the user\u0026rsquo;s signing keys through a side-channel attack. This will be fixed by making the code constant-time.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/zecsec.com\/posts\/security-audit-of-hanhs-ledger-app\/"},"author":{"@type":"Person","name":"Taylor Hornby"},"creator":{"@type":"Person","name":"Taylor Hornby"},"accountablePerson":{"@type":"Person","name":"Taylor Hornby"},"copyrightHolder":"ZecSec: Zcash Ecosystem Security","copyrightYear":"2023","dateCreated":"2023-09-21T01:01:00.00Z","datePublished":"2023-09-21T01:01:00.00Z","dateModified":"2023-09-21T01:01:00.00Z","publisher":{"@type":"Organization","name":"ZecSec: Zcash Ecosystem Security","url":"https://zecsec.com/","logo":{"@type":"ImageObject","url":"https:\/\/zecsec.com\/static\/favicon-32.png","width":"32","height":"32"}},"image":"https://zecsec.com/static/favicon-32.png","url":"https:\/\/zecsec.com\/posts\/security-audit-of-hanhs-ledger-app\/","wordCount":"582","genre":[],"keywords":[]}</script></head><body><a class=skip-link href=#main>Skip to main</a><main id=main><div class=content><header><p style=padding:0;margin:0><a href=/><b>ZecSec: Zcash Ecosystem Security</b>
<span class="text-stone-500 animate-blink">â–®</span></a></p><ul style=padding:0;margin:0><li><a href=/posts/><span>Blog</span></a><li><a href=/overview/><span>Overview</span></a><li><a href=/posts/zecsec-roadmap-for-2023/><span>Roadmap</span></a><li><a href=/contact/><span>Contact</span></a></li></ul></header><hr class=hr-list style=padding:0;margin:0><section><h2 class=post>Results of Auditing Hanh's Shielded Zcash Ledger App</h2><div class=post-date><span class="g time">September 21, 2023</span> &#8729;
By Taylor Hornby</div><p>In May and June of this year, I reviewed Hanh Huynh Huu&rsquo;s Ledger app supporting
shielded Zcash. The full audit report is available at the link below.</p><h2 id=summary-of-results>Summary of Results</h2><p>The main issues uncovered by the audit were the following:</p><h3 id=side-channel-leakage>Side-Channel Leakage</h3><p>The algorithm for producing transaction signatures is not constant-time,
therefore it may be possible to leak the user&rsquo;s signing keys through a
side-channel attack. This will be fixed by making the code constant-time.</p><h3 id=incompatibility-with-zip-32>Incompatibility with ZIP 32</h3><p>There is an incompatibility between <a href=https://zips.z.cash/zip-0032>ZIP 32</a>
and the key-derivation API currently provided on Ledger devices.</p><p>ZIP 32 derives a chain of keys from the user&rsquo;s root seed. Ledger&rsquo;s API does not
support ZIP 32 key derivation, and there is no way for an app to access the root
seed to do the derivation itself, since allowing an app to access the seed would
be a security risk. The Ledger app therefore needed to generate its keys in a
way that is not compatible with ZIP 32.</p><p>Given the current implementations of standard Zcash wallets and the Ledger app,
it would not be possible to import a standard wallet&rsquo;s seed phrase into a Ledger
and access shielded funds through the app. Vice-versa, importing a Ledger seed
phrase into a standard Zcash wallet would require the wallet to perform twice
the scanning effort to find all of the user&rsquo;s shielded funds.</p><p>The most-compatible way to resolve this issue would be for Ledger to add support
for ZIP 32 to their devices&rsquo; operating systems.</p><p>Failing that, ZIP 32 could be amended to be compatible with hardware wallets'
existing APIs; this would make seed phrases compatible between standard wallets
and the Ledger app, at the cost of needing to do twice the scanning effort when
importing old wallets.</p><p>Another potential solution is to develop a tool for deriving individual shielded
signing keys from a Ledger seed phrase, so that they can be manually imported
into a standard shielded wallet. Unfortunately this approach would still not
allow a standard seed phrase with shielded funds to be imported into a Ledger.</p><h3 id=burning-funds-via-invalid-ciphertext>Burning Funds via Invalid Ciphertext</h3><p>When a user&rsquo;s wallet receives a shielded Zcash transaction, it needs to receive
some additional information in order to spend the funds. This information is
put, by the sender, into the <em>note ciphertext</em>, which only the recipient&rsquo;s
wallet can decrypt.</p><p>A hardware wallet must ensure that these ciphertexts are produced honestly,
otherwise malware on the host computer could &ldquo;burn&rdquo; funds being sent by
replacing the ciphertext with junk data, preventing the recipient from accessing
the information needed to spend their funds.</p><p>The Ledger app is missing this ciphertext verification. It will be fixed by
having the hardware wallet compute (or re-compute and verify) the ciphertext,
rather than trusting the value provided by the host.</p><h3 id=other>Other</h3><p>Several other minor issues were found, including an issue where unified
addresses were not correctly displayed to the user; see the audit report for
full details.</p><h3 id=gaps-in-coverage>Gaps in Coverage</h3><p>While all of the ledger app&rsquo;s code was reviewed to some degree, there was not
enough time to thoroughly review some security-critical cryptographic code, like
the elliptic curve implementations. More review is needed in those areas; this
is discussed further in the report.</p><p>After the audit, we found that an implementation of one of the curves was using
an incomplete addition formula, when it should have been using a complete
addition formula. This issue has been reported separately.</p><h2 id=the-audit-report>The Audit Report</h2><p><a href=/audits/zcash-ledger-audit-report-v2.pdf><strong>Shielded Zcash Ledger App Audit Report (PDF)</strong></a></p></section><div id=comments><script src=https://utteranc.es/client.js repo=ZgotmplZ issue-term=pathname theme=ZgotmplZ crossorigin=anonymous async></script></div></div></main></body></html>